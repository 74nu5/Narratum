@page "/"
@rendermode InteractiveServer
@inject StoryLibraryService LibraryService
@inject NavigationManager Navigation

<PageTitle>Dashboard - Narratum</PageTitle>

<FluentStack Orientation="Orientation.Vertical" VerticalGap="24">
    <FluentLabel Typo="Typography.H1">âœ¨ Bienvenue sur Narratum</FluentLabel>
    
    <FluentCard>
        <FluentStack Orientation="Orientation.Horizontal" HorizontalGap="16">
            <FluentButton Appearance="Appearance.Accent" Href="/wizard" Style="flex: 1;">
                âž• CrÃ©er une nouvelle histoire
            </FluentButton>
            <FluentButton Appearance="Appearance.Neutral" Href="/library" Style="flex: 1;">
                ðŸ“š Voir toutes mes histoires
            </FluentButton>
        </FluentStack>
    </FluentCard>

    <FluentLabel Typo="Typography.H3">Histoires rÃ©centes</FluentLabel>
    
    @if (_recentStories == null)
    {
        <FluentProgressRing />
    }
    else if (!_recentStories.Any())
    {
        <FluentMessageBar Intent="MessageIntent.Info">
            Aucune histoire. CrÃ©ez-en une pour commencer !
        </FluentMessageBar>
    }
    else
    {
        <FluentStack Orientation="Orientation.Horizontal" Wrap="true" HorizontalGap="16">
            @foreach (var story in _recentStories)
            {
                <FluentCard Style="width: 300px; cursor: pointer;" @onclick="@(() => OpenStory(story.SlotName))">
                    <FluentLabel Typo="Typography.H4">@story.DisplayName</FluentLabel>
                    <FluentLabel>Genre: @story.GenreStyle</FluentLabel>
                    <FluentLabel>Pages: @story.PageCount</FluentLabel>
                    <FluentLabel Typo="Typography.Body">
                        ModifiÃ©: @story.LastModified.ToString("dd/MM/yyyy")
                    </FluentLabel>
                </FluentCard>
            }
        </FluentStack>
    }
</FluentStack>

@code {
    private List<StoryEntry>? _recentStories;

    protected override async Task OnInitializedAsync()
    {
        var allStories = await LibraryService.ListStoriesAsync();
        _recentStories = allStories.Take(6).ToList();
    }

    private void OpenStory(string slotName)
    {
        Navigation.NavigateTo($"/reader/{slotName}");
    }
}
